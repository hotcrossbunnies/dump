local Players = game:GetService("Players") -- p
local LocalPlayer = Players.LocalPlayer -- lp

local function predict(target)
    local v = target.Velocity
    local p = Vector3.new(v.X, v.Y / 5 + 1, v.Z - .2) / (.4 * ((LocalPlayer:GetNetworkPing() * 1000) / 50))
    return CFrame.new(target.Position + p, target.Position) * CFrame.Angles(math.rad(90), 0, 0)
end

workspace.FallenPartsDestroyHeight = tonumber("nan")
task.wait(.1)


_G.loop = not _G.loop
local Dupe
local Original = LocalPlayer.Character
if _G.loop then
    Original.Archivable = true

    Dupe = Original:Clone()
    Dupe.Parent = workspace
    workspace.CurrentCamera.CameraSubject = Dupe
else
    if Dupe then
        Dupe:Destroy()
        LocalPlayer.Character = Original
        workspace.CurrentCamera.CameraSubject = Original
    end
end


while _G.loop do
    local Character = Original
    
    local HumanoidRootPart = Character.HumanoidRootPart -- h
    local Humanoid = Character.Humanoid

    for _, Part in ipairs(Character:GetDescendants()) do
        if Part:IsA("BasePart") then
            Part.CanTouch = false
        end
    end

    LocalPlayer.Character = Dupe

    local PlayerList = Players:GetPlayers()
    table.remove(PlayerList, table.find(PlayerList, LocalPlayer))
    for _, Player in pairs(PlayerList) do
        local OldPos = HumanoidRootPart.CFrame
        local VCharacter = Player.Character
        local VHumanoidRootPart
        local VHumanoid
        if VCharacter then
            VHumanoidRootPart = VCharacter:FindFirstChild("HumanoidRootPart")
            VHumanoid = VCharacter:FindFirstChild("Humanoid")
        end
        if VHumanoidRootPart and VHumanoid and not (VHumanoid.SeatPart and VHumanoid.SeatPart.Anchored == true) then
            for i = 1, 5 do
                HumanoidRootPart.CFrame = VHumanoidRootPart.CFrame * CFrame.Angles(0, math.rad(90), 0)
                HumanoidRootPart.Velocity = Vector3.new(0, -1e9, 0)
                task.wait()
            end
            for i = 1, 5 do
                HumanoidRootPart.CFrame = predict(VHumanoidRootPart)
                HumanoidRootPart.Velocity = Vector3.new(0, -1e9, 0)
                task.wait()
            end

            local V3 = Vector3.new(0, 0, 0)
            Humanoid.Sit = true
            HumanoidRootPart.CFrame = OldPos
            for _, v in ipairs(Character:GetDescendants()) do
                if v:IsA("BasePart") then
                    v.Velocity, v.RotVelocity = V3, V3
                end
            end
            Humanoid.Sit = false
        end
    end
    task.wait()
end
